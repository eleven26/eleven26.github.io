<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"eleven26.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="eleven26">
<meta property="og:url" content="https://eleven26.github.io/page/21/index.html">
<meta property="og:site_name" content="eleven26">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="eleven26">
<meta property="article:tag" content="Go">
<meta property="article:tag" content="PHP">
<meta property="article:tag" content="Laravel">
<meta property="article:tag" content="Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://eleven26.github.io/page/21/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/21/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>eleven26</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">eleven26</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">100</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">346</span></a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">eleven26</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">346</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">100</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/eleven26" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;eleven26" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://eleven26.github.io/2022/08/04/linux/%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8Blinux%E7%9A%84%E5%8D%8A%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97%E5%85%A8%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="eleven26">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eleven26">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | eleven26">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/04/linux/%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8Blinux%E7%9A%84%E5%8D%8A%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97%E5%85%A8%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97/" class="post-title-link" itemprop="url">如何查看 Linux 的半连接队列、全连接队列？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-04 15:12:00" itemprop="dateCreated datePublished" datetime="2022-08-04T15:12:00+08:00">2022-08-04</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2
id="全连接队列大小和半连接队列大小如何设置">全连接队列大小和半连接队列大小如何设置？</h2>
<p>全连接大小：全连接大小取决于 <code>backlog</code> 和
<code>somaxconn</code> 的最小值，也就是
<code>min(backlog, somaxconn)</code></p>
<ul>
<li><code>somaxconn</code> 是 Linux 内核参数，默认 128，可通过
<code>/proc/sys/net/core/somaxconn</code> 进行配置</li>
<li><code>backlog</code> 是 <code>listen(int sockfd, int backlog)</code>
函数中的参数 <code>backlog</code></li>
</ul>
<p>半连接队列大小：通过
<code>/proc/sys/net/ipv4/tcp_max_syn_backlog</code> 来设置</p>
<h2
id="如何查看当前全连接队列和半连接队列的大小">如何查看当前全连接队列和半连接队列的大小？</h2>
<ol type="1">
<li>查看半连接队列：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -antp | grep SYN_RECV | wc -l</span><br><span class="line">233 # 表示半连接状态的 TCP 连接有 233 个</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>查看全连接队列</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ss -lnt | grep 6080</span><br><span class="line"></span><br><span class="line">State  Recv-Q Send-Q  Local Address:Port   Peer Address:Port</span><br><span class="line">LISTEN     0   100       :::6080                  :::*</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-l</code> 显示正在 Listen 的 socket</li>
<li><code>-n</code> 不解析服务名称</li>
<li><code>-t</code> 只显示 tcp</li>
<li><code>Recv-Q</code> 完成三次握手并等待服务端 <code>accept()</code>
的 TCP 全连接总数</li>
<li><code>Send-Q</code> 全连接队列大小</li>
</ul>
<h2 id="如何查看全连接半连接溢出">如何查看全连接半连接溢出？</h2>
<p><code>netstat -s | grep SYN</code> 如果开启了
<code>tcp_syncookies</code>，那么当半队列溢出的时候，
<code>95045 SYN cookies sent</code> 这一行会一直变大。</p>
<p><code>netstat -s | grep overflowed</code>
直接查看全链接队列是否有溢出，数字一直变大就是有溢出。</p>
<p><code>netstat -s | egrep "listen|LISTEN"</code> ：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">半连接队列溢出次数</span></span><br><span class="line">104625 SYNs to LISTEN sockets dropped</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">全连接队列溢出的次数</span></span><br><span class="line">7102 times the listen queue of a socket overflowed</span><br></pre></td></tr></table></figure>
<h2 id="全连接半连接溢出后如何处理">全连接半连接溢出后如何处理？</h2>
<h3 id="全连接队列满">全连接队列满</h3>
<p>当全连接队列已满就会根据 <code>tcp_abort_on_overflow</code>
策略进行处理。Linux 可通过
<code>/proc/sys/net/ipv4/tcp_abort_on_overflow</code> 进行配置。</p>
<ul>
<li><p><code>tcp_abort_on_overflow=0</code>，服务端 <code>accept</code>
队列满了的时候，客户端发来 <code>ack</code>，服务端直接丢弃该
<code>ACK</code>，此时服务端处于 <code>SYN_RCVD</code> 状态，客户端处于
<code>ESTABLISHED</code> 状态。在该状态下服务端会重传
<code>SYN-ACK</code> 报文。超过 <code>tcp_synack_retries</code>
次后，服务端不再重传，后续也不会有任何动作。此时如果客户端再发送数据过来，服务端会返回
<code>RST</code>。</p></li>
<li><p><code>tcp_abort_on_overflow=1</code>，服务端 <code>accept</code>
队列满了，客户端发来 <code>ack</code>，服务端直接返回 <code>RST</code>
通知 client，表示废掉这个握手过程和这个连接，client 会报
<code>connection reset by peer</code>。</p></li>
</ul>
<h3 id="半连接队列满">半连接队列满</h3>
<p>如果半连接队列满了，并且没有开启
<code>tcp_syncookies</code>，则会丢弃；</p>
<p><code>net.ipv4.tcp_syncookies=1</code> 表示开启
<code>tcp_syncookies</code>。开启后，服务端会生成一个 cookie，通过
<code>SYN+ACK</code> 报文返回给客户端，然后收到客户端下一个 ACK
报文后会校验 cookie，如果是服务端生成的，则直接放入 <code>accept</code>
队列。</p>
<blockquote>
<p>开启 <code>tcp_syncookies</code> 可防范 SYN 攻击。</p>
</blockquote>
<h2 id="syn-flood">syn flood</h2>
<p>Linux 下默认会进行 5 次重发 SYN-ACK 包，总共耗时大概一分钟。由于
SYN-ACK 超时需要 63
秒，那么就给攻击者一个攻击服务器的机会，攻击者在短时间内发送大量的 SYN
包给服务端，用于耗尽服务端的 SYN 队列。为了应对 SYN 攻击的问题，linux
提供了几个 TCP
参数：<code>tcp_syncookies</code>、<code>tcp_synack_retries</code>、<code>tcp_max_syn_backlog</code>、<code>tcp_abort_on_overflow</code></p>
<h2 id="syn-cookie">syn cookie</h2>
<p>Linux 实现了一种称为 SYN cookie 的机制，通过
<code>net.ipv4.tcp_syncookies</code> 控制，设置为 1 表示开启。简单说
SYNcookie
就是将连接信息编码在ISN（initialsequencenumber）中返回给客户端，这时服务端不需要将半连接保存在队列中，而是利用客户端随后发送的
ACK 带回的 ISN 还原连接信息，以完成连接的建立，避免了半连接队列被攻击
SYN 包填满。</p>
<p>SYN 半连接队列的大小是由
<code>/proc/sys/net/ipv4/tcp_max_syn_backlog</code>
这个内核参数控制的，有些内核似乎也受 listen 的 backlog
参数影响，取的是两个值的最小值。当这个队列满了，不开启 syncookies
的时候，服务端会丢弃新来的 SYN 包，而客户端在多次重发 SYN
包得不到响应而返回（connection timeout）错误。但是，当服务端开启了
syncookies=1，那么 SYN 半连接队列就没有逻辑上的最大值了，并且
<code>/proc/sys/net/ipv4/tcp_max_syn_backlog</code>
设置的值也会被忽略。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://eleven26.github.io/2022/08/04/golang/go%E4%B8%AD%E5%A6%82%E4%BD%95%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%97%B6%E9%97%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="eleven26">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eleven26">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | eleven26">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/04/golang/go%E4%B8%AD%E5%A6%82%E4%BD%95%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%97%B6%E9%97%B4/" class="post-title-link" itemprop="url">go 中如何格式化时间</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-04 09:41:30" itemprop="dateCreated datePublished" datetime="2022-08-04T09:41:30+08:00">2022-08-04</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>先来看一个简单的例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(time.Now().Format(<span class="string">&quot;2006&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们会觉得这会输出什么呢？输出的是
<code>2022</code>，也就是当前年份。</p>
<p>另一个例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(time.Now().Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：<code>2022-08-04 09:43:56</code></p>
<p>如果之前写其他语言的，看到这个结果估计和我一样觉得百思不得其解，为什么不是
<code>Y-m-d H:i:s</code>
这种格式呢？而且那个参数看起来就是一个时间戳。</p>
<h2 id="那个参数真的是时间戳吗">那个参数真的是时间戳吗？</h2>
<p>答案我们可以点开 <code>Format</code> 的源码看看就知道了：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Time)</span></span> Format(layout <span class="type">string</span>) <span class="type">string</span> &#123;</span><br><span class="line">	<span class="comment">// ... 省略，下面这个调用才是关键</span></span><br><span class="line">	b = t.AppendFormat(b, layout)</span><br><span class="line">	<span class="comment">// ... 省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们看到 <code>Format</code> 里面具体处理逻辑在
<code>AppendFormat</code> 函数里面，再点开 <code>AppendFormat</code>
看看：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> std &amp; stdMask &#123;</span><br><span class="line">    <span class="keyword">case</span> stdYear:</span><br><span class="line">        y := year</span><br><span class="line">        <span class="keyword">if</span> y &lt; <span class="number">0</span> &#123;</span><br><span class="line">            y = -y</span><br><span class="line">        &#125;</span><br><span class="line">        b = appendInt(b, y%<span class="number">100</span>, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">case</span> stdLongYear:</span><br><span class="line">        b = appendInt(b, year, <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">case</span> stdMonth:</span><br><span class="line">        b = <span class="built_in">append</span>(b, month.String()[:<span class="number">3</span>]...)</span><br><span class="line">    <span class="keyword">case</span> stdLongMonth:</span><br><span class="line">        m := month.String()</span><br><span class="line">        b = <span class="built_in">append</span>(b, m...)</span><br><span class="line">    <span class="comment">// ... 省略其他 case</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到里面的 <code>stdYear</code>、<code>stdLongYear</code>
之类的常量实际上就是我们传入到 <code>Format</code>
的参数里面的数字。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	_                        = <span class="literal">iota</span></span><br><span class="line">	stdLongMonth             = <span class="literal">iota</span> + stdNeedDate  <span class="comment">// &quot;January&quot;</span></span><br><span class="line">	stdMonth                                       <span class="comment">// &quot;Jan&quot;</span></span><br><span class="line">	stdNumMonth                                    <span class="comment">// &quot;1&quot;</span></span><br><span class="line">	stdZeroMonth                                   <span class="comment">// &quot;01&quot;</span></span><br><span class="line">	stdLongWeekDay                                 <span class="comment">// &quot;Monday&quot;</span></span><br><span class="line">	stdWeekDay                                     <span class="comment">// &quot;Mon&quot;</span></span><br><span class="line">	stdDay                                         <span class="comment">// &quot;2&quot;</span></span><br><span class="line">	stdUnderDay                                    <span class="comment">// &quot;_2&quot;</span></span><br><span class="line">	stdZeroDay                                     <span class="comment">// &quot;02&quot;</span></span><br><span class="line">	stdUnderYearDay                                <span class="comment">// &quot;__2&quot;</span></span><br><span class="line">	stdZeroYearDay                                 <span class="comment">// &quot;002&quot;</span></span><br><span class="line">	stdHour                  = <span class="literal">iota</span> + stdNeedClock <span class="comment">// &quot;15&quot;</span></span><br><span class="line">	stdHour12                                      <span class="comment">// &quot;3&quot;</span></span><br><span class="line">	stdZeroHour12                                  <span class="comment">// &quot;03&quot;</span></span><br><span class="line">	stdMinute                                      <span class="comment">// &quot;4&quot;</span></span><br><span class="line">	stdZeroMinute                                  <span class="comment">// &quot;04&quot;</span></span><br><span class="line">	stdSecond                                      <span class="comment">// &quot;5&quot;</span></span><br><span class="line">	stdZeroSecond                                  <span class="comment">// &quot;05&quot;</span></span><br><span class="line">	stdLongYear              = <span class="literal">iota</span> + stdNeedDate  <span class="comment">// &quot;2006&quot;</span></span><br><span class="line">	stdYear                                        <span class="comment">// &quot;06&quot;</span></span><br><span class="line">	stdPM                    = <span class="literal">iota</span> + stdNeedClock <span class="comment">// &quot;PM&quot;</span></span><br><span class="line">	stdpm                                          <span class="comment">// &quot;pm&quot;</span></span><br><span class="line">	stdTZ                    = <span class="literal">iota</span>                <span class="comment">// &quot;MST&quot;</span></span><br><span class="line">	stdISO8601TZ                                   <span class="comment">// &quot;Z0700&quot;  // prints Z for UTC</span></span><br><span class="line">	stdISO8601SecondsTZ                            <span class="comment">// &quot;Z070000&quot;</span></span><br><span class="line">	stdISO8601ShortTZ                              <span class="comment">// &quot;Z07&quot;</span></span><br><span class="line">	stdISO8601ColonTZ                              <span class="comment">// &quot;Z07:00&quot; // prints Z for UTC</span></span><br><span class="line">	stdISO8601ColonSecondsTZ                       <span class="comment">// &quot;Z07:00:00&quot;</span></span><br><span class="line">	stdNumTZ                                       <span class="comment">// &quot;-0700&quot;  // always numeric</span></span><br><span class="line">	stdNumSecondsTz                                <span class="comment">// &quot;-070000&quot;</span></span><br><span class="line">	stdNumShortTZ                                  <span class="comment">// &quot;-07&quot;    // always numeric</span></span><br><span class="line">	stdNumColonTZ                                  <span class="comment">// &quot;-07:00&quot; // always numeric</span></span><br><span class="line">	stdNumColonSecondsTZ                           <span class="comment">// &quot;-07:00:00&quot;</span></span><br><span class="line">	stdFracSecond0                                 <span class="comment">// &quot;.0&quot;, &quot;.00&quot;, ... , trailing zeros included</span></span><br><span class="line">	stdFracSecond9                                 <span class="comment">// &quot;.9&quot;, &quot;.99&quot;, ..., trailing zeros omitted</span></span><br><span class="line"></span><br><span class="line">	stdNeedDate       = <span class="number">1</span> &lt;&lt; <span class="number">8</span>             <span class="comment">// need month, day, year</span></span><br><span class="line">	stdNeedClock      = <span class="number">2</span> &lt;&lt; <span class="number">8</span>             <span class="comment">// need hour, minute, second</span></span><br><span class="line">	stdArgShift       = <span class="number">16</span>                 <span class="comment">// extra argument in high bits, above low stdArgShift</span></span><br><span class="line">	stdSeparatorShift = <span class="number">28</span>                 <span class="comment">// extra argument in high 4 bits for fractional second separators</span></span><br><span class="line">	stdMask           = <span class="number">1</span>&lt;&lt;stdArgShift - <span class="number">1</span> <span class="comment">// mask out argument</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>所以，其实答案已经有了，我们对照一下我们的参数
<code>2006-01-02 15:04:05</code>，可以很简单在上述常量里面找到对应的常量：</p>
<ul>
<li><code>2006</code> =&gt; <code>stdLongYear</code></li>
<li><code>01</code> =&gt; <code>stdZeroMonth</code></li>
<li><code>02</code> =&gt; <code>stdZeroDay</code></li>
<li><code>15</code> =&gt; <code>stdHour</code></li>
<li><code>04</code> =&gt; <code>stdZeroMinute</code></li>
<li><code>05</code> =&gt; <code>stdZeroSecond</code></li>
</ul>
<p>而 <code>layout</code> 参数里面的 <code>-</code> 以及 <code>:</code>
都会原样输出。</p>
<blockquote>
<p>根据给出的这些常量，我们就可以将时间格式化为我们想要的格式了。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://eleven26.github.io/2022/08/04/golang-library/cobra-%E6%9B%B4%E5%AE%B9%E6%98%93%E5%9C%B0%E6%9E%84%E5%BB%BA%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="eleven26">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eleven26">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | eleven26">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/04/golang-library/cobra-%E6%9B%B4%E5%AE%B9%E6%98%93%E5%9C%B0%E6%9E%84%E5%BB%BA%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">cobra - 更容易地构建命令行应用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-04 08:48:00" itemprop="dateCreated datePublished" datetime="2022-08-04T08:48:00+08:00">2022-08-04</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="cobra-是什么">cobra 是什么</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/spf13/cobra">cobra</a>
的主要功能是创建强大的现代 cli 应用程序。目前市面上许多的著名的 Go
语言开源项目都是使用 Cobra 来构建的，例如：K8s、Hugo、etcd、Docker
等，是非常可靠的一个开源项目。</p>
<h2 id="没有-cobra-之前用什么">没有 cobra 之前用什么</h2>
<p>如果不用 cobra，我们也可以使用 go 自带的 <code>flag</code> 标准库</p>
<h3 id="flag-的基本用法">flag 的基本用法</h3>
<p>下面代码中，我们调用标准库 <code>flag</code> 的
<code>StringVar</code> 方法实现了对命令行参数 name
的解析和绑定，其各个形参的含义分别为命令行标识位的名称、默认值、帮助信息。</p>
<p>命令行参数支持如下三种命令行标志语法：</p>
<ul>
<li><code>-flag</code> 仅支持布尔类型</li>
<li><code>-flag x</code> 仅支持非布尔类型</li>
<li><code>-flag=x</code> 均支持</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> name <span class="type">string</span></span><br><span class="line">    <span class="comment">// 名称为 name、默认值为 &quot;Go go go!&quot;</span></span><br><span class="line">	flag.StringVar(&amp;name, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;Go go go!&quot;</span>, <span class="string">&quot;帮助信息&quot;</span>)</span><br><span class="line">	flag.StringVar(&amp;name, <span class="string">&quot;n&quot;</span>, <span class="string">&quot;Go go go!&quot;</span>, <span class="string">&quot;帮助信息&quot;</span>)</span><br><span class="line">	flag.Parse()</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;name: %s\n&quot;</span>, name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 均输出 abc</span><br><span class="line">go run main.go -name=abc</span><br><span class="line">go run main.go -n=abc</span><br></pre></td></tr></table></figure>
<h3 id="子命令实现">子命令实现</h3>
<p>在我们日常使用的 CLI
应用中，另一个最常见的功能就是子命令的使用，一个工具它可能包含大量相关联的功能命令以此形成工具集，可以说是刚需，那么这个功能在标准库
flag 中可以如何实现呢，如下述示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.Parse()</span><br><span class="line"></span><br><span class="line">	args := flag.Args()</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(args) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> args[<span class="number">0</span>] &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;go&quot;</span>:</span><br><span class="line">		goCmd := flag.NewFlagSet(<span class="string">&quot;go&quot;</span>, flag.ExitOnError)</span><br><span class="line">		goCmd.StringVar(&amp;name, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;Go 语言&quot;</span>, <span class="string">&quot;帮助信息&quot;</span>)</span><br><span class="line">		_ = goCmd.Parse(args[<span class="number">1</span>:])</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;php&quot;</span>:</span><br><span class="line">		phpCmd := flag.NewFlagSet(<span class="string">&quot;php&quot;</span>, flag.ExitOnError)</span><br><span class="line">		phpCmd.StringVar(&amp;name, <span class="string">&quot;n&quot;</span>, <span class="string">&quot;PHP 语言&quot;</span>, <span class="string">&quot;帮助信息&quot;</span>)</span><br><span class="line">		_ = phpCmd.Parse(args[<span class="number">1</span>:])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	log.Printf(<span class="string">&quot;name: %s&quot;</span>, name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述代码中，我们首先调用了 <code>flag.Parse</code>
方法，将命令行解析为定义的标志，便于我们后续的参数使用。</p>
<p>另外由于我们需要处理子命令的情况，因此我们调用了
<code>flag.NewFlagSet</code>
方法，该方法会返回带有指定名称和错误处理属性的空命令集给我们去使用，相当于就是创建了一个新的命令集去支持子命令了。</p>
<p>这里需要特别注意的是 <code>flag.NewFlagSet</code> 方法的第二个参数是
<code>ErrorHandling</code>，用于指定处理异常错误，其内置提供以下三种模式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    <span class="comment">// 返回错误描述</span></span><br><span class="line">    ContinueOnError ErrorHandling = <span class="literal">iota</span></span><br><span class="line">    <span class="comment">// 调用 os.Exit(2) 退出程序</span></span><br><span class="line">    ExitOnError</span><br><span class="line">    <span class="comment">// 调用 panic 语句抛出错误异常</span></span><br><span class="line">    PanicOnError</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜ go run main.go go    </span><br><span class="line">2022/08/04 08:59:21 name: Go 语言</span><br><span class="line">➜ go run main.go php  </span><br><span class="line">2022/08/04 09:00:54 name: PHP 语言</span><br><span class="line">➜ go run main.go php -n abc   </span><br><span class="line">2022/08/04 09:01:05 name: abc</span><br></pre></td></tr></table></figure>
<h2 id="使用-cobra">使用 cobra</h2>
<p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/spf13/cobra</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> wordCmd = &amp;cobra.Command&#123;</span><br><span class="line">		Use:   <span class="string">&quot;test&quot;</span>,         <span class="comment">// 子命令的命令标识</span></span><br><span class="line">		Short: <span class="string">&quot;测试&quot;</span>,           <span class="comment">// 简短说明</span></span><br><span class="line">		Long:  <span class="string">&quot;测试 cobra 子命令&quot;</span>, <span class="comment">// 完整说明</span></span><br><span class="line">		Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">			fmt.Println(args)</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> rootCmd = &amp;cobra.Command&#123;&#125;</span><br><span class="line">	rootCmd.AddCommand(wordCmd)</span><br><span class="line">	err := rootCmd.Execute()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;cmd.Execute err: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，我们添加了一个 test 子命令，使用：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  go run main.go test abc</span><br><span class="line">[abc]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里把 <code>wordCmd</code> 和 <code>rootCmd</code>
都写在一块不是一个好的实践，如果命令多的情况下，这个文件会非常大。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://eleven26.github.io/2022/08/03/golang-library/viper-go%20%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="eleven26">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eleven26">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | eleven26">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/03/golang-library/viper-go%20%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">viper - go 配置管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-03 16:55:30" itemprop="dateCreated datePublished" datetime="2022-08-03T16:55:30+08:00">2022-08-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://github.com/spf13/viper">Viper</a> 是适用于 Go
应用程序的完整配置解决方案。</p>
<h2 id="安装">安装</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/spf13/viper</span><br></pre></td></tr></table></figure>
<h2 id="什么是-viper">什么是 Viper？</h2>
<p>Viper 是适用于 Go
应用程序的完整配置解决方案。它被设计用于在应用程序中工作，并且可以处理所有类型的配置需求和格式。它支持以下特性：</p>
<ul>
<li>设置默认值</li>
<li>从 JSON、TOML、YAML、HCL、envfile 和 Java properties
格式的配置文件读取配置信息</li>
<li>实时监控和重新读取配置文件（可选）</li>
<li>从环境变量中读取</li>
<li>从远程配置系统（etcd 或 Consul）读取并监控配置变化</li>
<li>从命令行参数读取配置</li>
<li>从 buffer 读取配置</li>
<li>显式配置值</li>
</ul>
<h2 id="viper-配置优先级">Viper 配置优先级</h2>
<p>Viper 会按照下面的优先级。每个项目的优先级都高于它下面的项目：</p>
<ul>
<li>显式调用 Set 设置值</li>
<li>命令行参数（flag）</li>
<li>环境变量</li>
<li>配置文件</li>
<li>key/value 存储</li>
<li>默认值</li>
</ul>
<blockquote>
<p>重要：目前 Viper 配置的键（Key）是大小写不敏感的。</p>
</blockquote>
<h2 id="把值存入-viper">把值存入 Viper</h2>
<h3 id="设置默认值">设置默认值</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viper.SetDefault(<span class="string">&quot;ContentDir&quot;</span>, <span class="string">&quot;content&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="读取配置文件">读取配置文件</h3>
<p>Viper 可以搜索多个路径，但目前单个 Viper
实例只支持单个配置文件。Viper
不默认任何配置搜索路径，将默认决策留给应用程序。</p>
<p>下面是一个如何使用 Viper
搜索和读取配置文件的示例。不需要任何特定的路径，但是至少应该提供一个配置文件预期出现的路径。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">viper.SetConfigFile(<span class="string">&quot;./config.yaml&quot;</span>) <span class="comment">// 指定配置文件路径</span></span><br><span class="line">viper.SetConfigName(<span class="string">&quot;config&quot;</span>) <span class="comment">// 配置文件名称(无扩展名)</span></span><br><span class="line">viper.SetConfigType(<span class="string">&quot;yaml&quot;</span>) <span class="comment">// 如果配置文件的名称中没有扩展名，则需要配置此项</span></span><br><span class="line">viper.AddConfigPath(<span class="string">&quot;/etc/appname/&quot;</span>)   <span class="comment">// 查找配置文件所在的路径</span></span><br><span class="line">viper.AddConfigPath(<span class="string">&quot;$HOME/.appname&quot;</span>)  <span class="comment">// 多次调用以添加多个搜索路径</span></span><br><span class="line">viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)               <span class="comment">// 还可以在工作目录中查找配置</span></span><br><span class="line">err := viper.ReadInConfig() <span class="comment">// 查找并读取配置文件</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123; <span class="comment">// 处理读取配置文件的错误</span></span><br><span class="line">	<span class="built_in">panic</span>(fmt.Errorf(<span class="string">&quot;Fatal error config file: %s \n&quot;</span>, err))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在加载配置文件出错时，你可以像下面这样处理找不到配置文件的特定情况：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> _, ok := err.(viper.ConfigFileNotFoundError); ok &#123;</span><br><span class="line">        <span class="comment">// 配置文件未找到错误；如果需要可以忽略</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 配置文件被找到，但产生了另外的错误</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置文件找到并成功解析</span></span><br></pre></td></tr></table></figure>
<h2 id="写入配置文件">写入配置文件</h2>
<p>从配置文件中读取配置是有用的，但是有时候你想要在运行时所做的所有修改。为此，可以使用下面一组命令，每个命令都有自己的用途：</p>
<ul>
<li><code>WriteConfig</code> - 将当前 的 viper
配置写入预定义的路径并覆盖（如果存在的话）。如果没有预定义的路径，则报错。</li>
<li><code>SafeWriteConfig</code> - 跟 <code>WriteConfig</code>
一样，不过如果文件已经存在则不覆盖。</li>
<li><code>WriteConfigAs</code> - 将当前的 viper
配置写入给定的文件路径。将覆盖给定的文件（如果它存在的话）</li>
<li><code>SafeWriteCofnigAs</code> - 将当前的 viper
配置写入给定的文件路径。不会覆盖已有的文件。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">viper.WriteConfig() <span class="comment">// 将当前配置写入“viper.AddConfigPath()”和“viper.SetConfigName”设置的预定义路径</span></span><br><span class="line">viper.SafeWriteConfig()</span><br><span class="line">viper.WriteConfigAs(<span class="string">&quot;/path/to/my/.config&quot;</span>)</span><br><span class="line">viper.SafeWriteConfigAs(<span class="string">&quot;/path/to/my/.config&quot;</span>) <span class="comment">// 因为该配置文件写入过，所以会报错</span></span><br><span class="line">viper.SafeWriteConfigAs(<span class="string">&quot;/path/to/my/.other_config&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="监控并重新读取配置文件">监控并重新读取配置文件</h2>
<p>Viper 支持在运行时实时读取配置文件的功能。</p>
<blockquote>
<p>确保在调用 <code>WatchConfig()</code> 之前添加了所有的配置路径。</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">viper.WatchConfig()</span><br><span class="line">viper.OnConfigChange(<span class="function"><span class="keyword">func</span><span class="params">(e fsnotify.Event)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 配置文件发生变更之后会调用的回调函数</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;Config file changed:&quot;</span>, e.Name)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="从-io.reader-读取配置">从 io.Reader 读取配置</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">viper.SetConfigType(<span class="string">&quot;yaml&quot;</span>) <span class="comment">// 或者 viper.SetConfigType(&quot;YAML&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 任何需要将此配置添加到程序中的方法。</span></span><br><span class="line"><span class="keyword">var</span> yamlExample = []<span class="type">byte</span>(<span class="string">`</span></span><br><span class="line"><span class="string">Hacker: true</span></span><br><span class="line"><span class="string">name: steve</span></span><br><span class="line"><span class="string">hobbies:</span></span><br><span class="line"><span class="string">- skateboarding</span></span><br><span class="line"><span class="string">- snowboarding</span></span><br><span class="line"><span class="string">- go</span></span><br><span class="line"><span class="string">clothing:</span></span><br><span class="line"><span class="string">  jacket: leather</span></span><br><span class="line"><span class="string">  trousers: denim</span></span><br><span class="line"><span class="string">age: 35</span></span><br><span class="line"><span class="string">eyes : brown</span></span><br><span class="line"><span class="string">beard: true</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line"></span><br><span class="line">viper.ReadConfig(bytes.NewBuffer(yamlExample))</span><br><span class="line"></span><br><span class="line">viper.Get(<span class="string">&quot;name&quot;</span>) <span class="comment">// 这里会得到 &quot;steve&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="覆盖配置">覆盖配置</h2>
<p>这些可能来自命令行的配置，也可能来自你自己的应用程序逻辑。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">viper.Set(<span class="string">&quot;Verbose&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">viper.Set(<span class="string">&quot;LogFile&quot;</span>, LogFile)</span><br></pre></td></tr></table></figure>
<h2 id="注册和使用别名">注册和使用别名</h2>
<p>别名允许多个键引用单个值：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">viper.RegisterAlias(<span class="string">&quot;loud&quot;</span>, <span class="string">&quot;Verbose&quot;</span>)  <span class="comment">// 注册别名（此处loud和Verbose建立了别名）</span></span><br><span class="line"></span><br><span class="line">viper.Set(<span class="string">&quot;verbose&quot;</span>, <span class="literal">true</span>) <span class="comment">// 结果与下一行相同</span></span><br><span class="line">viper.Set(<span class="string">&quot;loud&quot;</span>, <span class="literal">true</span>)   <span class="comment">// 结果与前一行相同</span></span><br><span class="line"></span><br><span class="line">viper.GetBool(<span class="string">&quot;loud&quot;</span>) <span class="comment">// true</span></span><br><span class="line">viper.GetBool(<span class="string">&quot;verbose&quot;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="使用环境变量">使用环境变量</h2>
<p>Viper 完全支持环境变量。有五种方法可以使用 ENV 相关特性：</p>
<ul>
<li><code>AutomaticEnv()</code></li>
<li><code>BuildEnv(string...): error</code></li>
<li><code>SetEnvPrefix(string)</code></li>
<li><code>SetEnvKeyReplacer(string...) *strings.Replacer</code></li>
<li><code>AllowEmptyEnv(bool)</code></li>
</ul>
<blockquote>
<p>使用 ENV 变量时，务必意识到 Viper 将 ENV 变量视为区分大小写。</p>
</blockquote>
<p>Viper 提供了一种机制来确保 ENV 变量是唯一的。通过使用
<code>SetEnvPrefix</code>，你可以告诉 Viper
在读取环境变量时使用前缀。<code>BindEnv</code> 和
<code>AutomaticEnv</code> 都将使用这个前缀。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SetEnvPrefix(<span class="string">&quot;spf&quot;</span>) <span class="comment">// 将自动转为大写</span></span><br><span class="line">BindEnv(<span class="string">&quot;id&quot;</span>)</span><br><span class="line"></span><br><span class="line">os.Setenv(<span class="string">&quot;SPF_ID&quot;</span>, <span class="string">&quot;13&quot;</span>) <span class="comment">// 通常是在应用程序之外完成的</span></span><br><span class="line"></span><br><span class="line">id := Get(<span class="string">&quot;id&quot;</span>) <span class="comment">// 13</span></span><br></pre></td></tr></table></figure>
<h2 id="使用-flags">使用 Flags</h2>
<p>Viper 具有绑定到标志的能力。</p>
<p>与 <code>BindEnv</code>
类似，该值不是在调用绑定方法时设置的，而是在访问该方法时设置的。这意味着你可以根据需要尽早进行绑定，即使在
<code>init()</code> 函数中也是如此。</p>
<p>对于单个标志，<code>BindPFlag()</code> 方法提供此功能。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">serverCmd.Flags().Int(<span class="string">&quot;port&quot;</span>, <span class="number">1138</span>, <span class="string">&quot;Port to run Application server on&quot;</span>)</span><br><span class="line">viper.BindPFlag(<span class="string">&quot;port&quot;</span>, serverCmd.Flags().Lookup(<span class="string">&quot;port&quot;</span>))</span><br></pre></td></tr></table></figure>
<h2 id="从-viper-获取值">从 Viper 获取值</h2>
<p>在 Viper
中，有几种方法可以根据值的类型获取值。存在以下功能和方法：</p>
<ul>
<li><code>Get(key string) : interface&#123;&#125;</code></li>
<li><code>GetBool(key string) : bool</code></li>
<li><code>GetFloat64(key string) : float64</code></li>
<li><code>GetInt(key string) : int</code></li>
<li><code>GetIntSlice(key string) : []int</code></li>
<li><code>GetString(key string) : string</code></li>
<li><code>GetStringMap(key string) : map[string]interface&#123;&#125;</code></li>
<li><code>GetStringMapString(key string) : map[string]string</code></li>
<li><code>GetStringSlice(key string) : []string</code></li>
<li><code>GetTime(key string) : time.Time</code></li>
<li><code>GetDuration(key string) : time.Duration</code></li>
<li><code>IsSet(key string) : bool</code></li>
<li><code>AllSettings() : map[string]interface&#123;&#125;</code></li>
</ul>
<p>需要认识到一件重要事情是，每一个 Get
方法在找不到值的时候都会返回零值。为了检查给定的键是否存在，提供了
<code>IsSet()</code> 方法。</p>
<h3 id="访问嵌套的键">访问嵌套的键</h3>
<p>访问器方法也接受深度嵌套键的格式化路径。例如，如果加载下面的 JSON
文件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">5799</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;datastore&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;metric&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">3099</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;warehouse&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;198.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">2112</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Viper 可以通过传入 <code>.</code> 分隔的路径来访问嵌套字段：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetString(<span class="string">&quot;database.metric.host&quot;</span>) <span class="comment">// 127.0.0.1</span></span><br></pre></td></tr></table></figure>
<h3 id="提取子树">提取子树</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viper.Sub(<span class="string">&quot;app.cache&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="反序列化">反序列化</h3>
<p>你可以选择将所有或特定的值解析道结构体、map 等。</p>
<p>有两种方法可以做到这一点：</p>
<ul>
<li><code>Unmarshal(rawVal interface&#123;&#125;) : error</code></li>
<li><code>UnmarshalKey(key string, rawVal interface&#123;&#125;) : error</code></li>
</ul>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> config <span class="keyword">struct</span> &#123;</span><br><span class="line">	Port <span class="type">int</span></span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	PathMap <span class="type">string</span> <span class="string">`mapstructure:&quot;path_map&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> C config</span><br><span class="line"></span><br><span class="line">err := viper.Unmarshal(&amp;C)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	t.Fatalf(<span class="string">&quot;unable to decode into struct, %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="序列化成字符串">序列化成字符串</h3>
<p>你可能需要将 viper
中保存的所有设置序列化到一个字符串中，而不是将它们写入到一个文件中。你可以将自己喜欢的格式的序列化器与
<code>AllSettings()</code> 返回的配置一起使用。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://eleven26.github.io/2022/08/03/golang/go%20mod%20%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="eleven26">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eleven26">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | eleven26">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/03/golang/go%20mod%20%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">go mod 依赖管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-03 15:43:30" itemprop="dateCreated datePublished" datetime="2022-08-03T15:43:30+08:00">2022-08-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>注：如果你的 GoLand 不会自动拉取依赖，检查一下 IDE
配置里面是不是没有启用 Go Modules。</p>
</blockquote>
<h2 id="go-mod-介绍">go mod 介绍</h2>
<p>Modules 官方定义为：</p>
<blockquote>
<p>模块是相关 Go 包的集合。modules 是源代码交换和版本控制的单元。go
命令直接支持使用 modules，包括记录和解析对其他模块的依赖性。 modules
替换旧的基于 GOPATH 的方法来指定在给定构建中使用哪些源文件。</p>
</blockquote>
<h2 id="如何使用-go-mod">如何使用 go mod</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go env -w GO111MODULE=on</span><br><span class="line">go env -w GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure>
<p>我们可以先设置一下 <code>GO111MODULE</code> 和 <code>GOPROXY</code>
环境变量，可以直接加到环境变量中：</p>
<ul>
<li><code>GO111MODULE=on</code> 开启 go modules 功能</li>
<li><code>GOPROXY</code> 设置 go 代理，下载依赖的时候可以更快地下载</li>
</ul>
<h2 id="go-mod-命令">go mod 命令</h2>
<ul>
<li><code>go mod download</code>：下载依赖包</li>
<li><code>go mod edit</code>：编辑 go.mod</li>
<li><code>go mod graph</code>：打印模块依赖图</li>
<li><code>go mod init</code>：初始化新的 go module
在当前目录（嗯，是的，我们写的代码其实也等于是一个 go module）</li>
<li><code>go mod tidy</code>：拉取缺少的模块，移除不用的模块</li>
<li><code>go mod vendor</code>：将依赖复制到 vendor 下</li>
<li><code>go mod verify</code>：验证依赖是否正确</li>
<li><code>go mod why</code>：解释为什么需要依赖</li>
</ul>
<h2 id="go.mod-文件">go.mod 文件</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module hello</span><br><span class="line"></span><br><span class="line">go 1.18</span><br></pre></td></tr></table></figure>
<p><code>go.mod</code> 文件一旦创建后，它的内容将会被 go toolchain
全面掌控。go toolchain 会在各类命令执行时，比如
<code>go get</code>、<code>go build</code>、<code>go mod</code>
等修改和维护 <code>go.mod</code> 文件。</p>
<p><code>go.mod</code> 提供了
<code>module</code>，<code>require</code>，<code>replace</code> 和
<code>exclude</code> 四个命令。</p>
<ul>
<li><code>module</code>：指定包的名字（路径）</li>
<li><code>require</code>：指定依赖项模块</li>
<li><code>replace</code>：替换依赖模块（比如自己修改了一版，就可以使用
<code>replace</code> 将依赖替换为自己的实现，但是代码里面
<code>import</code> 路径还是旧的路径）</li>
<li><code>exclude</code>：用于排除某个包的特定版本，与
<code>replace</code> 类似，仅在当前 module 为 <code>main module</code>
时有效，其他项目引用当前项目时，<code>exclude</code> 指令会被忽略</li>
</ul>
<p>go module 安装依赖的原则是先拉取最新的 release tag，若无则拉最新的
commit。</p>
<p>go 会自动生成一个 go.sum 文件来记录 dependency tree。</p>
<h2 id="go-get-升级">go get 升级</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u need-upgrade-package</span><br></pre></td></tr></table></figure>
<p>升级后会将新的依赖版本更新到 <code>go.mod</code>，也可以使用
<code>go get -u</code> 升级所有依赖。</p>
<ul>
<li>运行 <code>go get -u</code>
将会升级到最新的次要版本或者修订版本（x.y.z 是修订版本号，y
是次要版本号）</li>
<li>运行 <code>go get -u=patch</code> 将会升级到最新的修订版本</li>
<li>运行 <code>go get package@version</code> 将会升级到指定的版本号
version</li>
<li>运行 <code>go get</code> 如果有版本的更改，那么 <code>go.mod</code>
文件也会更改</li>
</ul>
<h2 id="go.sum">go.sum</h2>
<p>这个文件记录了当前拉取的实际的版本号。可以保证我们每次拉取的都是相同的版本，除非我们手动去更新。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/20/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/70/">70</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/22/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">eleven26</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/eleven26" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
