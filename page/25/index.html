<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"eleven26.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="eleven26">
<meta property="og:url" content="https://eleven26.github.io/page/25/index.html">
<meta property="og:site_name" content="eleven26">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="eleven26">
<meta property="article:tag" content="Go">
<meta property="article:tag" content="PHP">
<meta property="article:tag" content="Laravel">
<meta property="article:tag" content="Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://eleven26.github.io/page/25/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/25/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>eleven26</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">eleven26</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">100</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">346</span></a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">eleven26</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">346</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">100</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/eleven26" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;eleven26" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://eleven26.github.io/2022/07/10/golang/gin%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81%E7%9A%84struct%20tag/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="eleven26">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eleven26">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | eleven26">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/10/golang/gin%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81%E7%9A%84struct%20tag/" class="post-title-link" itemprop="url">gin表单验证struct tag</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-10 21:08:30" itemprop="dateCreated datePublished" datetime="2022-07-10T21:08:30+08:00">2022-07-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文是对 <a
target="_blank" rel="noopener" href="https://github.com/gin-gonic/gin/issues/3234">validate tag not
working in ShouldBindWith</a> 的回答。</p>
<p>有人提了这么一个问题：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin/binding&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// MyStruct ..</span></span><br><span class="line"><span class="keyword">type</span> MyStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">	Order <span class="type">string</span> <span class="string">`form:&quot;order,default=DESC&quot; validate:&quot;omitempty,oneof=ASC DESC&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startPage</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> person MyStruct</span><br><span class="line">	<span class="keyword">if</span> c.ShouldBindWith(&amp;person, binding.Query) == <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;====== Only Bind By Query String ======&quot;</span>)</span><br><span class="line">		log.Println(person.Order)</span><br><span class="line">		c.String(http.StatusOK, <span class="string">&quot;Success&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">		<span class="comment">// log.Println(person.Address)</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.String(http.StatusBadRequest, <span class="string">&quot;Failed&quot;</span>)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	route := gin.Default()</span><br><span class="line">	route.Any(<span class="string">&quot;/testing&quot;</span>, startPage)</span><br><span class="line">	route.Run(<span class="string">&quot;:8085&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后表单验证的时候，明明 Order 传递了一个不符合
<code>oneof=ASC DESC</code> 的值，但却验证通过了。</p>
<h2 id="原因">原因</h2>
<p>虽然 gin 使用了 <a
target="_blank" rel="noopener" href="https://github.com/go-playground/validator">go-playground/validator</a>
来作为表单验证的组件，但是在 gin 里面却修改了 struct 验证的
tagname，我们可以看看 <a
target="_blank" rel="noopener" href="https://github.com/gin-gonic/gin/blob/4b68a5f12af4d6d2be83e1895f783d5dd5d5a148/binding/default_validator.go#L95">default_validator.go#L95</a></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *defaultValidator)</span></span> lazyinit() &#123;</span><br><span class="line">	v.once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		v.validate = validator.New()</span><br><span class="line">		v.validate.SetTagName(<span class="string">&quot;binding&quot;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，我们就不能通过给 struct 加上 <code>vaidate</code> 的 tag
来写上我们的验证规则，取而代之的是，需要将我们的验证规则写在
<code>binding</code> 这个 tag 里面：</p>
<p>将 <code>validate:"omitempty,oneof=ASC DESC"</code> 替换成
<code>binding:"omitempty,oneof=ASC DESC"</code>，我们即可实现在 gin
中使用 validator 验证我们的 struct。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">	Order <span class="type">string</span> <span class="string">`form:&quot;order,default=DESC&quot; binding:&quot;omitempty,oneof=ASC DESC&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考官方文档： <a
target="_blank" rel="noopener" href="https://gin-gonic.com/zh-cn/docs/examples/binding-and-validation/">模型绑定和验证</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://eleven26.github.io/2022/07/06/linux/tcpdump%20%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="eleven26">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eleven26">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | eleven26">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/06/linux/tcpdump%20%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">tcpdump 用法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-06 19:20:00" itemprop="dateCreated datePublished" datetime="2022-07-06T19:20:00+08:00">2022-07-06</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>tcpdump 是一个命令行的网络流量分析工具，功能非常强大，一般我们用来抓
TCP 的包。</p>
<blockquote>
<p>非常重要：如果 tcpdump 没有输出，尝试加上 <code>-i any</code>
选项。</p>
</blockquote>
<h2 id="tcpdump-核心参数图解">tcpdump 核心参数图解</h2>
<p><img src="/images/linux/tcpdump/args.png" /></p>
<p>tcpdump 参数的组成部分： 1. <code>option</code> 可选参数 2.
<code>proto</code> 类过滤器：根据协议进行过滤，可识别的关键词有：tcp,
udp 等 3. <code>type</code> 类过滤器：可识别的关键词有：host, net, port,
portrange 4. <code>direction</code>
类过滤器：根据数据流向进行过滤，可识别的关键词有：src,
dst，你可以使用逻辑运算符进行组合，如 <code>src or dst</code></p>
<h2 id="理解-tcpdump-的输出">理解 tcpdump 的输出</h2>
<h3 id="输出内容结构">输出内容结构</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">21:26:49.013621 IP 172.20.20.1.15605 &gt; 172.20.20.2.5920: Flags [P.], seq 49:97, ack 106048, win 4723, length 48</span><br></pre></td></tr></table></figure>
<ul>
<li>第一列：时分秒毫秒 <code>21:26:49.013621</code></li>
<li>第二列：网络协议 IP</li>
<li>第三列：发送方的 ip地址+端口号，其中 172.20.20.1 是 ip，而 15605
是端口号</li>
<li>第四列：箭头 &gt;，表示数据流向</li>
<li>第五列：接收方的 ip地址+端口号，其中 172.20.20.2 是 ip，而 5920
是端口号</li>
<li>第六列：冒号</li>
<li>第七列： 数据包内容，包括 Flags 标识符，seq 号，ack 号，win
窗口，数据长度，其中 [P.] 表示 PUSH 标志位为 1</li>
</ul>
<h4 id="flags-标识符">Flags 标识符</h4>
<ul>
<li><code>[S]</code>：SYN（开始连接）</li>
<li><code>[P]</code>：PSH（推送数据）</li>
<li><code>[F]</code>：FIN（结束连接）</li>
<li><code>[R]</code>：RST（重置连接）</li>
<li><code>[.]</code>：没有
Flag（意思是除上面四种类型外的其他情况，有可能是 ACK 也有可能是
URG）</li>
</ul>
<h2 id="常规过滤规则">常规过滤规则</h2>
<h3 id="基于-ip-地址过滤host">基于 IP 地址过滤：host</h3>
<p>使用 <code>host</code> 就可以指定 host ip 进行过滤：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump host 192.168.10.100</span><br></pre></td></tr></table></figure>
<p>数据包的 ip 可以再细分为源 ip 和目标 ip 两种：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据源 ip 进行过滤</span></span><br><span class="line">tcpdump -i eth2 src 192.168.10.100</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据目标 ip 进行过滤</span></span><br><span class="line">tdpcump -i eth2 dst 192.168.10.200</span><br></pre></td></tr></table></figure>
<h3 id="基于网段进行过滤net">基于网段进行过滤：net</h3>
<p>若你的 ip 范围是一个网段，可以直接这样指定：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump net 192.168.10.0/24</span><br></pre></td></tr></table></figure>
<p>网段统一可以再细分为源网段和目标网段：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据源网段进行过滤</span></span><br><span class="line">tcpdump src net 192.168</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据目标网段进行过滤</span></span><br><span class="line">tcpdump dst net 192.168</span><br></pre></td></tr></table></figure>
<h3 id="基于端口进行过滤port">基于端口进行过滤：port</h3>
<p>使用 <code>port</code> 就可以指定特定端口进行过滤：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump port 8888</span><br></pre></td></tr></table></figure>
<p>端口同样可以再细分为源端口，目标端口：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据源端口进行过滤</span></span><br><span class="line">tcpdump src port 8888</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据目标端口进行过滤</span></span><br><span class="line">tcpdump dst port 8888</span><br></pre></td></tr></table></figure>
<p>如果你想同时指定两个端口你可以这样写：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump port 80 or port 8888</span><br></pre></td></tr></table></figure>
<p>但也可以简写成这样：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump port 80 or 8888</span><br></pre></td></tr></table></figure>
<p>如果你想抓取的不再是一两个端口，而是一个范围，一个一个指定就非常麻烦了，此时你可以这样指定一个端口段：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcpdump portrange 8000-8080</span><br><span class="line">tcpdump src portrange 8000-8080</span><br><span class="line">tcpdump dst portrange 8000-8080</span><br></pre></td></tr></table></figure>
<p>对于一些常见协议的默认端口，我们还可以直接使用协议名，而不用具体的端口号：</p>
<p>比如 http == 80, https == 443 等。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump tcp port http</span><br></pre></td></tr></table></figure>
<h3 id="基于协议进行过滤proto">基于协议进行过滤：proto</h3>
<p>常见的网络协议有 tcp，udp，icmp，http，ip，ipv6 等。</p>
<p>若你只想查看 icmp 的包，可以直接这样写：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump icmp</span><br></pre></td></tr></table></figure>
<p>protocol
可选值：ip，ip6，arp，rarp，atalk，aarp，decnet，sca，lat，mopdl，moprc，iso，stp，ipx，or
netbeui</p>
<h3 id="基于ip协议版本进行过滤">基于IP协议版本进行过滤</h3>
<p>当你想查看 tcp 的包，你也许会这样子写：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump tcp</span><br></pre></td></tr></table></figure>
<p>这样子写也没问题，就是不够精准，为什么这么说呢？</p>
<p>ip 根据版本的不同，可以再细分为 IPv4 和 IPv6 两种，如果你只指定了
tcp，这两种其实都会包含在内。</p>
<p>那有什么办法，能够将 IPv4 和 IPv6 区分开来呢？</p>
<p>很简单，如果是 IPv4 的 tcp 包，就这样写（数字 6 表示的是 tcp 在 ip
报文中的编号。）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &#x27;ip proto tcp&#x27;</span><br><span class="line">tcpdump ip proto 6</span><br><span class="line">tcpdump &#x27;ip protochain tcp&#x27;</span><br><span class="line">tcpdump ip protochain 6</span><br></pre></td></tr></table></figure>
<p>而如果是 IPv6 的 tcp 包，就这样写：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &#x27;ip6 proto tcp&#x27;</span><br><span class="line">tcpdump ip6 proto 6</span><br><span class="line">tcpdump &#x27;ip6 protochain tcp&#x27;</span><br><span class="line">tcpdump ip6 prorochain 6</span><br></pre></td></tr></table></figure>
<p>关于上面这几个命令示例，有两点需要注意：</p>
<ol type="1">
<li>跟在 proto 和 protochain 后面的如果是 tcp, udp, icmp
，那么过滤器需要用引号包含，这是因为 tcp,udp, icmp 是 tcpdump
的关键字。</li>
<li>跟在ip 和 ip6 关键字后面的 proto 和 protochain
是两个新面孔，看起来用法类似，它们是否等价，又有什么区别呢？</li>
</ol>
<p>proto 后面跟的 <protocol> 的关键词是固定的，只能是 ip, ip6, arp,
rarp, atalk, aarp, decnet, sca, lat, mopdl, moprc, iso, stp, ipx, or
netbeui 这里面的其中一个。</p>
<p>而 protochain 后面跟的 protocol
要求就没有那么严格，它可以是任意词，只要 tcpdump 的 IP 报文头部里的
protocol 字段为 <protocol> 就能匹配上。</p>
<p>理论上来讲，下面两种写法效果是一样的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &#x27;ip &amp;&amp; tcp&#x27;</span><br><span class="line">tcpdump &#x27;ip proto tcp&#x27;</span><br></pre></td></tr></table></figure>
<p>同样的，这两种写法也是一样的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &#x27;ip6 &amp;&amp; tcp&#x27;</span><br><span class="line">tcpdump &#x27;ip6 proto tcp&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="可选参数解析">可选参数解析</h2>
<h3 id="设置不解析域名提升速度">设置不解析域名提升速度</h3>
<ul>
<li><code>-n</code> 不把 ip 转化成域名，直接显示 ip，避免执行 DNS
lookups 的过程，速度会快很多。</li>
<li><code>-nn</code> 不把协议和端口号转化成名字，速度也会快很多</li>
<li><code>-N</code> 不打印出 host
的域名部分。比如，如果设置了此选项，tcpdump 将会打印 'nic' 而不是
'nic.ddn.mil'</li>
</ul>
<h3 id="过滤结果输出到文件">过滤结果输出到文件</h3>
<p>使用 tcpdump
工具抓到包后，往往需要再借助其他的工具进行分析，比如常见的
wireshark。</p>
<p>而要使用 wireshark，我们得将 tcpdump
抓到的包数据生成到文件中，最后再使用 wireshark 打开它即可。</p>
<p>使用 <code>-w</code> 参数后接一个以 <code>.pcap</code>
后缀命名的文件名，就可以将 tcpdump 抓到的数据保存到文件中。（可以使用
wireshark 分析这个文件，也可以使用 tcpdump 读取）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump icmp -w icmp.pcap</span><br></pre></td></tr></table></figure>
<h3 id="从文件中读取包数据">从文件中读取包数据</h3>
<p>使用 <code>-w</code> 是写入数据到文件，而使用 <code>-r</code>
是从文件中读取数据。</p>
<p>读取后，我们照样可以使用上述的过滤器语法进行过滤分析。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -r all.pcap</span><br></pre></td></tr></table></figure>
<p>读取之后过滤：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -r all.pcap src host 192.168.2.11</span><br></pre></td></tr></table></figure>
<h3 id="控制详细内容的输出">控制详细内容的输出</h3>
<ul>
<li><code>-v</code> 产生详细的输出。比如包的 TTL，id
标识，数据包长度，以及 IP
包的一些选项。同时它还会打开一些附加的包完整性检测，比如对 IP 和 ICMP
包头部的校验和。</li>
<li><code>-vv</code> 产生比-v更详细的输出.
比如NFS回应包中的附加域将会被打印, SMB数据包也会被完全解码。</li>
<li><code>-vvv</code> 产生比-vv更详细的输出。比如 telent 时所使用的SB,
SE 选项将会被打印,
如果telnet同时使用的是图形界面，其相应的图形选项将会以16进制的方式打印出来</li>
</ul>
<h3 id="控制时间的显示">控制时间的显示</h3>
<ul>
<li><code>-t</code> 在每行的输出中不输出时间</li>
<li><code>-tt</code> 在每行的输出中会输出时间戳</li>
<li><code>-ttt</code> 输出每两行打印的时间间隔（以毫秒为单位）</li>
<li><code>-tttt</code>
在每行打印的时间戳之前添加日期的打印（此种选项，输出的时间最为直观）</li>
</ul>
<h3 id="显示数据包的头部">显示数据包的头部</h3>
<ul>
<li><code>-x</code> 以 16
进制的形式打印每个包的头部数据（但不包括数据链路层的头部）</li>
<li><code>-xx</code> 以 16
进制的形式打印每个包的头部数据（包括数据链路层的头部）</li>
<li><code>-X</code> 以 16 进制和 ASCII
码形式打印出每个包的数据（但不包括连接层的头部），这在分析一些新协议的数据包很方便。</li>
<li><code>-XX</code> 以 16 进制和 ASCII
码形式打印出每个包的数据（包括连接层的头部），这在分析一些新协议的数据包很方便</li>
</ul>
<h3 id="过滤指定网卡的数据包">过滤指定网卡的数据包</h3>
<ul>
<li><code>-i</code> 指定要过滤的网卡接口，如果要查看所有网卡，可以
<code>-i any</code></li>
</ul>
<h3 id="过滤特定流向的数据包">过滤特定流向的数据包</h3>
<ul>
<li><code>-Q</code>
选择是入方向还是出方向的数据包，可选项有：in，out，inout。也可以使用
<code>--direction=[direction]</code> 这种写法</li>
</ul>
<h3 id="其他常用的一些参数">其他常用的一些参数</h3>
<ul>
<li><code>-A</code> 以 ASCII
码方式显示每一个数据包（不显示链路层头部信息）。在抓取包含网页数据的数据包时，可方便查看数据。</li>
<li><code>-l</code>
基于行的输出，便于你保存查看，或者交给其他工具分析</li>
<li><code>-q</code>
简洁地打印输出。即打印很少的协议相关的信息，从而输出行都比较简短</li>
<li><code>-c</code> 捕获 count 个包 tcpdump 就退出</li>
<li><code>-s</code> tcpdump 默认只会截取前 <code>96</code>
字节的内容，要想截取所有的报文内容，可以使用
<code>-s number</code>，<code>number</code>
就是你要截取的报文子节数，如果是 0 的话，表示截取报文全部内容。</li>
<li><code>-S</code> 使用绝对序列号，而不是相对序列号</li>
<li><code>-C</code> file-size，tcpdump
在把原始数据包直接保存到文件中之前，检查此文件大小是否超过
file-size。如果超过了，将关闭文件，另创一个文件继续用于原始数据包的记录。新创建的文件名与
-w 选项指定的文件名一致，但文件名后多了一个* 数字。该数字会从 1
开始随着新创建文件的增多而增加。file-size
的单位是百万子节（nt：这里指1,000,000个字节,并非1,048,576个字节,
后者是以1024字节为1k, 1024k字节为1M计算所得, 即1M=1024 ＊ 1024 ＝
1,048,576）</li>
<li><code>-F</code> 使用 file
文件作为过滤条件表达式的输入，此时命令行上的输入将被忽略。</li>
</ul>
<h3 id="对输出内容进行控制的参数">对输出内容进行控制的参数</h3>
<ul>
<li><code>-D</code> 显示所有可用的网络接口的列表（跟 netstat -i
类似）</li>
<li><code>-e</code>
每行的打印输出中将包括数据包的数据链路层头部信息</li>
<li><code>-E</code> 揭秘 IPSEC 数据</li>
<li><code>-L</code> 列出指定网络接口所支持的数据链路层的类型后退出</li>
<li><code>-Z</code> 后接用户名，在抓包时会受到权限的控制。如果以 root
用户启动 tcpdump，tcpdump 将会有超级用户权限</li>
<li><code>-d</code> 打印出易读的包匹配码</li>
<li><code>-dd</code> 以 C 语言的形式打印出包匹配码</li>
<li><code>-ddd</code> 以十进制的形式打印出包匹配码</li>
</ul>
<h2 id="过滤规则组合">过滤规则组合</h2>
<p>有编程基础的同学，对于下面三个逻辑运算符应该不陌生了吧。</p>
<ul>
<li><code>and</code> 所有的条件都要满足，也可以表示为
<code>&amp;&amp;</code></li>
<li><code>or</code> 只要有一个条件满足就可以，也可以表示为
<code>||</code></li>
<li><code>not</code> 取反，也可以使用 <code>|</code></li>
</ul>
<p>举个例子，我想需要抓取一个来自 <code>10.5.2.3</code>，发往任意主机的
3389 端口的包。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump src 10.5.2.3 and dst port 3389</span><br></pre></td></tr></table></figure>
<p>当你在使用多个过滤器进行组合时，有可能需要用到括号，而括号在 shell
中是特殊符号，因此你需要使用引号将其包含。例子如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &#x27;src 10.0.2.4 and (dst port 3389 or 22)&#x27;</span><br></pre></td></tr></table></figure>
<p>而在单个过滤器里，常常会判断一条件是否成立，这时候，就要使用下面两个符号：</p>
<ul>
<li><code>=</code> 判断二者相等</li>
<li><code>==</code> 判断二者相等</li>
<li><code>!=</code> 判断二者不相等</li>
</ul>
<p>当你使用这两个符号时，tcpdump
还提供了一些关键字的接口来方便我们进行判断，比如：</p>
<ul>
<li>if：表示网卡接口名</li>
<li>proc：表示进程名</li>
<li>pid：表示进程 id</li>
<li>svc：表示 service class</li>
<li>dir：表示方向，in 和 out</li>
<li>eproc：表示 effictive processes name</li>
<li>epid：表示 effictive process ID</li>
</ul>
<p>比如我现在要过滤来自进程名为 nc 发出的流经 en0
网卡的数据包，或者不流经 en0 的入方向数据包，可以这样子写。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &quot;(if=en0 and proc=nc) || (if != en0 and dir = in)&quot;</span><br></pre></td></tr></table></figure>
<h2 id="特殊过滤规则">特殊过滤规则</h2>
<h3 id="根据-tcpflags-进行过滤">根据 tcpflags 进行过滤</h3>
<p><img src="/images/linux/tcpdump/header.png" /></p>
<p>tcpdump 支持我们根据数据包的标志位进行过滤：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proto [ expr:size ]</span><br></pre></td></tr></table></figure>
<ul>
<li><code>proto</code>
可以是熟知的协议之一（如ip，arp，udp，icmp，ipv6）</li>
<li><code>expr</code>
可以是数值，也可以是一个表达式，表示与指定的协议头开始处的子节偏移量。</li>
<li><code>size</code> 是可选的，表示从子节偏移量开始取的子节数量</li>
</ul>
<ol type="1">
<li>tcpflags 可以理解为一个别名常量，相当于
13，它代表着与指定的协议头开头相关的子节偏移量，也就是标志位，所以
<code>tcp[tcpflags]</code> 等价于 <code>tcp[13]</code>就是 tcp 报文的第
13 个字节。</li>
<li>tcp-fin, tcp-syn, tcp-rst, tcp-push, tcp-ack, tcp-urg
这些同样可以理解为别名常量，分别代表 1，2，4，8，16，32，64。（就是
000001，000010 ... 这些二进制数）</li>
</ol>
<p>由于数字不好记忆，所以一般使用这样的 “别名常量” 表示。</p>
<p>因此当下面这个表达式成立时，就代表这个包是一个 syn 包。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp[tcpflags] == tcp-syn</span><br></pre></td></tr></table></figure>
<p>要抓取特定数据包，方法有很多种。</p>
<p>下面以最常见的 syn 包为例，演示一下如何用 tcpdump 抓取到 syn
包，而其他的类型的包也是同样的道理。</p>
<p>据我总结，主要有三种写法：</p>
<ol type="1">
<li>使用数字表示偏移量：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 &quot;tcp[13] &amp; 2 != 0&quot;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>使用别名常量表示偏移量：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 &quot;tcp[tcpflags] &amp; tcp-syn != 0&quot;</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>使用混合写法</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 &quot;tcp[tcpflags] &amp; 2 != 0&quot;</span><br><span class="line">tcpdump -i eth0 &quot;tcp[13] &amp; tcp-syn != 0&quot;</span><br></pre></td></tr></table></figure>
<p>如果我想同时捕获多种类型的包呢，比如 syn 或 ack 包</p>
<ol type="1">
<li>第一种写法</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 &#x27;tcp[13] == 2 or tcp[13] == 16&#x27;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>第二种写法</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 &#x27;tcp[tcpflags] == tcp-syn or tcp[tcpflags] == tcp-ack&#x27;</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>第三种写法</li>
</ol>
<blockquote>
<p>捕获的是 tcp and ack</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 &quot;tcp[tcpflags] &amp; (tcp-syn|tcp-ack) != 0&quot;</span><br></pre></td></tr></table></figure>
<ol start="4" type="1">
<li>第四种写法：注意这里是单个等号，而不是像上面一样两个等号，18
(syn+ack) = 2 (syn) + 16(ack)</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 &#x27;tcp[13] = 18&#x27;</span><br><span class="line">tcpdump -i eth0 &#x27;tcp[tcpflags] = 18&#x27;</span><br></pre></td></tr></table></figure>
<p>tcp 中有类似 tcp-syn 的别名常量，其他协议也是有的，比如 icmp
协议，可以使用的别名常量有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">icmp-echoreply, icmp-unreach, icmp-sourcequench, </span><br><span class="line">icmp-redirect, icmp-echo, icmp-routeradvert,</span><br><span class="line">icmp-routersolicit, icmp-timx-ceed, icmp-paramprob, </span><br><span class="line">icmp-tstamp, icmp-tstampreply,icmp-ireq, </span><br><span class="line">icmp-ireqreply, icmp-maskreq, icmp-maskreply</span><br></pre></td></tr></table></figure>
<h3 id="基于包大小进行过滤">基于包大小进行过滤</h3>
<p>若你想查看指定大小的数据包，也是可以的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcpdump less 32</span><br><span class="line">tcpdump greater 64</span><br><span class="line">tcpdump &lt;= 128</span><br></pre></td></tr></table></figure>
<h3 id="根据-mac-地址进行过滤">根据 mac 地址进行过滤</h3>
<p>例子如下，其中 ehost 是记录在 /etc/ethers 里的 name</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcpdump ether host [ehost]</span><br><span class="line">tcpdump ether dst [ehost]</span><br><span class="line">tcpdump ether src [ehost]</span><br></pre></td></tr></table></figure>
<h3 id="过滤通过指定网关的数据包">过滤通过指定网关的数据包</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump gateway [host]</span><br></pre></td></tr></table></figure>
<h3 id="过滤广播多播数据包">过滤广播/多播数据包</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tcpdump ether broadcast</span><br><span class="line">tcpdump ether multicast</span><br><span class="line"></span><br><span class="line">tcpdump ip broadcast</span><br><span class="line">tcpdump ip multicast</span><br><span class="line"></span><br><span class="line">tcpdump ip6 multicast</span><br></pre></td></tr></table></figure>
<h2 id="抓包实战应用例子">抓包实战应用例子</h2>
<h3 id="提取-http-的-useragent">提取 HTTP 的 UserAgent</h3>
<p>从 HTTP 请求头提取 HTTP 的User-Agent：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -nn -A -s1500 -l | grep &quot;User-Agent:&quot;</span><br></pre></td></tr></table></figure>
<p>通过 <code>egrep</code> 可以同时提取 User-Agent 和 主机名（或其他
HTTP 头）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -nn -A -s1500 -l | egrep &quot;User-Agent:|Host:&quot;</span><br></pre></td></tr></table></figure>
<h3 id="抓取-http-get-和-post-请求">抓取 HTTP GET 和 POST 请求</h3>
<p>抓取 HTTP GET 请求包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tcpdump -s 0 -A -vv <span class="string">&#x27;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tcpdump -vvAls0 | grep <span class="string">&#x27;GET&#x27;</span></span></span><br></pre></td></tr></table></figure>
<p>抓取 HTTP POST 请求包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tcpdump -s 0 -A -vv <span class="string">&#x27;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tcpdump -vvAls0 | grep <span class="string">&#x27;POST&#x27;</span></span></span><br></pre></td></tr></table></figure>
<p>注意：该方法不能保证抓取到 HTTP POST 有效数据流量，因为一个 POST
请求会被分割为多个 TCP 数据包。</p>
<h3 id="找出发包数量最多的-ip">找出发包数量最多的 IP</h3>
<p>找出一段时间内发包最多的 IP，或者从一堆报文中找出发包最多的
IP，可以使用下面的命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -nnn -t -c 200 | cut -f 1,2,3,4 -d &#x27;.&#x27; | sort | uniq -c | sort -nr | head -n 20</span><br></pre></td></tr></table></figure>
<ul>
<li><code>cut -f 1,2,3,4 -d '.'</code>: 以 .
为分隔符，打印出每行的前四列。即 IP 地址。</li>
<li><code>sort | uniq -c</code>: 排序并计数</li>
<li><code>sort -nr</code>: 按照数值大小逆向排序</li>
</ul>
<h3 id="抓取-dns-请求和响应">抓取 DNS 请求和响应</h3>
<p>DNS 的默认端口是 53，因此可以通过端口进行过滤：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i any -s0 port 53</span><br></pre></td></tr></table></figure>
<h3 id="切割-pcap-文件">切割 pcap 文件</h3>
<p>当抓取大量数据并写入文件时，可以自动切割为多个大小相同的文件。例如，下面的命令表示每
3600 秒创建一个新文件
<code>capture-(hour).pcap</code>，每个文件大小不超过
<code>200*1000000</code> 字节：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump  -w /tmp/capture-%H.pcap -G 3600 -C 200</span><br></pre></td></tr></table></figure>
<p>这些文件的命名为 <code>capture-&#123;1-24&#125;.pcap</code>，24
小时之后，之前的文件就会被覆盖。</p>
<h3 id="提取-http-post-请求中的密码">提取 HTTP POST 请求中的密码</h3>
<p>从 HTTP POST 请求中提取密码和主机名：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -s 0 -A -n -l | egrep -i &quot;POST /|pwd=|passwd=|password=|Host:&quot;</span><br></pre></td></tr></table></figure>
<h3 id="提取-http-请求的-url">提取 HTTP 请求的 URL</h3>
<p>提取 HTTP 请求的主机名和路径：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -s 0 -v -n -l | egrep -i &quot;POST /|GET /|Host:&quot;</span><br></pre></td></tr></table></figure>
<h3 id="抓取-http-有效数据包">抓取 HTTP 有效数据包</h3>
<p>抓取 80 端口的 HTTP 有效数据包，排除 TCP 连接建立过程的数据包（SYN /
FIN / ACK）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &#x27;tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="结合-wireshark-进行分析">结合 Wireshark 进行分析</h3>
<p>通常 Wireshark（或 tshark）比 tcpdump
更容易分析应用层协议。一般的做法是在远程服务器上先使用 tcpdump
抓取数据并写入文件，然后再将文件拷贝到本地工作站上用 Wireshark
分析。</p>
<p>还有一种更高效的方法，可以通过 ssh 连接将抓取到的数据实时发送给
Wireshark 进行分析。以 MacOS 系统为例，可以通过 brew cask install
wireshark 来安装，然后通过下面的命令来分析：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@remotesystem &#x27;tcpdump -s0 -c 1000 -nn -w - not port 22&#x27; | /Applications/Wireshark.app/Contents/MacOS/Wireshark -k -i -</span><br></pre></td></tr></table></figure>
<p>例如，如果想分析 DNS 协议，可以使用下面的命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@remotesystem &#x27;tcpdump -s0 -c 1000 -nn -w - port 53&#x27; | /Applications/Wireshark.app/Contents/MacOS/Wireshark -k -i -</span><br></pre></td></tr></table></figure>
<p>-c 选项用来限制抓取数据的大小。如果不限制大小，就只能通过 ctrl-c
来停止抓取，这样一来不仅关闭了 tcpdump，也关闭了 wireshark。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://eleven26.github.io/2022/07/06/linux/netstat%20%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="eleven26">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eleven26">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | eleven26">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/06/linux/netstat%20%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">netstat 用法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-06 19:07:00" itemprop="dateCreated datePublished" datetime="2022-07-06T19:07:00+08:00">2022-07-06</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>netstat 命令用于显示各种网络相关信息。</p>
<h2 id="常见参数">常见参数</h2>
<ul>
<li><code>-a</code> (all) 显示所有选项，默认不显示 <code>LISTEN</code>
相关</li>
<li><code>-t</code> (tcp) 仅显示 <code>tcp</code> 相关选项</li>
<li><code>-u</code> (udp) 仅显示 <code>udp</code> 相关选项</li>
<li><code>-n</code> 拒绝显示别名，能显示数字的全部转化成数字</li>
<li><code>-l</code> 仅列出有在
<code>Listen</code>（监听）的服务状态</li>
<li><code>-p</code> 显示建立相关链接的程序名</li>
<li><code>-r</code> 显示路由信息，路由表</li>
<li><code>-e</code> 显示扩展信息，例如 <code>uid</code> 等</li>
<li><code>-s</code> 按各个协议进行统计</li>
<li><code>-c</code> 每隔一个固定时间，执行该 <code>netstat</code>
命令</li>
<li><code>-i</code> --interfaces，显示所有网卡</li>
<li><code>-s</code> 显示网络统计信息</li>
</ul>
<h2 id="示例">示例</h2>
<h3 id="显示正在监听的-tcp-套接字">显示正在监听的 tcp 套接字</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tl</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State</span><br><span class="line">tcp        0      0 localhost:9121          0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 localhost:websm         0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 0.0.0.0:zabbix-agent    0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 localhost:9187          0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 0.0.0.0:zabbix-trapper  0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 0.0.0.0:xprint-server   0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 0.0.0.0:commplex-main   0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 0.0.0.0:empowerid       0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 localhost:cslistener    0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 0.0.0.0:rsync           0.0.0.0:*               LISTEN</span><br></pre></td></tr></table></figure>
<h3 id="显示路由表">显示路由表</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -r</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface</span><br><span class="line">default         gateway         0.0.0.0         UG        0 0          0 enp4s0</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U         0 0          0 docker0</span><br><span class="line">172.18.0.0      0.0.0.0         255.255.0.0     U         0 0          0 br-4caf812bdaa6</span><br><span class="line">172.19.0.0      0.0.0.0         255.255.0.0     U         0 0          0 br-bf1a2715a536</span><br><span class="line">172.20.0.0      0.0.0.0         255.255.0.0     U         0 0          0 br-24ea9b4941ce</span><br><span class="line">172.21.0.0      0.0.0.0         255.255.0.0     U         0 0          0 br-dad742f48f75</span><br><span class="line">172.22.0.0      0.0.0.0         255.255.0.0     U         0 0          0 br-c3b89e07005b</span><br><span class="line">172.23.0.0      0.0.0.0         255.255.0.0     U         0 0          0 br-e80111182b15</span><br><span class="line">172.24.0.0      0.0.0.0         255.255.0.0     U         0 0          0 br-52c539f436eb</span><br><span class="line">172.27.0.0      0.0.0.0         255.255.0.0     U         0 0          0 br-6135592da74f</span><br><span class="line">172.30.0.0      0.0.0.0         255.255.0.0     U         0 0          0 br-2b9072cf2223</span><br><span class="line">192.168.2.0     0.0.0.0         255.255.255.0   U         0 0          0 enp4s0</span><br><span class="line">192.168.250.0   0.0.0.0         255.255.255.0   U         0 0          0 br-ff86e2f8db31</span><br></pre></td></tr></table></figure>
<h3 id="显示相关的程序名">显示相关的程序名</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tlp</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 localhost:9121          0.0.0.0:*               LISTEN      6994/redis_exporter</span><br><span class="line">tcp        0      0 localhost:websm         0.0.0.0:*               LISTEN      6970/prometheus</span><br><span class="line">tcp        0      0 0.0.0.0:zabbix-agent    0.0.0.0:*               LISTEN      1495/zabbix_agentd</span><br><span class="line">tcp        0      0 localhost:9187          0.0.0.0:*               LISTEN      6992/postgres_expor</span><br><span class="line">tcp        0      0 0.0.0.0:zabbix-trapper  0.0.0.0:*               LISTEN      3160/zabbix_server</span><br><span class="line">tcp        0      0 0.0.0.0:xprint-server   0.0.0.0:*               LISTEN      6979/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:commplex-main   0.0.0.0:*               LISTEN      3152/python3</span><br><span class="line">tcp        0      0 0.0.0.0:empowerid       0.0.0.0:*               LISTEN      2271/nginx: master</span><br><span class="line">tcp        0      0 localhost:cslistener    0.0.0.0:*               LISTEN      1757/php-fpm: maste</span><br><span class="line">tcp        0      0 0.0.0.0:rsync           0.0.0.0:*               LISTEN      949/rsync</span><br><span class="line">tcp        0      0 0.0.0.0:mysql           0.0.0.0:*               LISTEN      2216/mysqld</span><br><span class="line">tcp        0      0 localhost:jetdirect     0.0.0.0:*               LISTEN      6984/node_exporter</span><br><span class="line">tcp        0      0 localhost:9229          0.0.0.0:*               LISTEN      6991/gitlab-workhor</span><br><span class="line">tcp        0      0 localhost:distinct      0.0.0.0:*               LISTEN      1493/php-fpm: maste</span><br><span class="line">tcp        0      0 localhost:webcache      0.0.0.0:*               LISTEN      7142/unicorn master</span><br><span class="line">tcp        0      0 localhost:9168          0.0.0.0:*               LISTEN      6975/ruby</span><br><span class="line">tcp        0      0 0.0.0.0:9264            0.0.0.0:*               LISTEN      2271/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:http            0.0.0.0:*               LISTEN      2271/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:scp-config      0.0.0.0:*               LISTEN      2271/nginx: master</span><br></pre></td></tr></table></figure>
<h3 id="拒绝显示别名">拒绝显示别名</h3>
<p>还是用上一个命令，上一个命令的输出中，我们可以看到某些应该是数字端口的地方，却出现了一些单词，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp        0      0 localhost:websm         0.0.0.0:*               LISTEN      6970/prometheus</span><br></pre></td></tr></table></figure>
<p>我们可以加上 <code>-n</code> 参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nltp</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 127.0.0.1:9121          0.0.0.0:*               LISTEN      6994/redis_exporter</span><br><span class="line">tcp        0      0 127.0.0.1:9090          0.0.0.0:*               LISTEN      6970/prometheus</span><br><span class="line">tcp        0      0 0.0.0.0:10050           0.0.0.0:*               LISTEN      1495/zabbix_agentd</span><br><span class="line">tcp        0      0 127.0.0.1:9187          0.0.0.0:*               LISTEN      6992/postgres_expor</span><br><span class="line">tcp        0      0 0.0.0.0:10051           0.0.0.0:*               LISTEN      3160/zabbix_server</span><br><span class="line">tcp        0      0 0.0.0.0:8100            0.0.0.0:*               LISTEN      6979/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:5000            0.0.0.0:*               LISTEN      3152/python3</span><br><span class="line">tcp        0      0 0.0.0.0:7080            0.0.0.0:*               LISTEN      2271/nginx: master</span><br><span class="line">tcp        0      0 127.0.0.1:9000          0.0.0.0:*               LISTEN      1757/php-fpm: maste</span><br><span class="line">tcp        0      0 0.0.0.0:873             0.0.0.0:*               LISTEN      949/rsync</span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      2216/mysqld</span><br><span class="line">tcp        0      0 127.0.0.1:9100          0.0.0.0:*               LISTEN      6984/node_exporter</span><br><span class="line">tcp        0      0 127.0.0.1:9229          0.0.0.0:*               LISTEN      6991/gitlab-workhor</span><br><span class="line">tcp        0      0 127.0.0.1:9999          0.0.0.0:*               LISTEN      1493/php-fpm: maste</span><br><span class="line">tcp        0      0 127.0.0.1:8080          0.0.0.0:*               LISTEN      7142/unicorn master</span><br><span class="line">tcp        0      0 127.0.0.1:9168          0.0.0.0:*               LISTEN      6975/ruby</span><br><span class="line">tcp        0      0 0.0.0.0:9264            0.0.0.0:*               LISTEN      2271/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      2271/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:10001           0.0.0.0:*               LISTEN      2271/nginx: master</span><br></pre></td></tr></table></figure>
<p>这样我们就可以看到具体监听的端口了。</p>
<h3 id="查看建立的连接">查看建立的连接</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ant | grep ESTABLISHED</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">tcp        0      0 192.168.2.168:51924     192.168.2.156:9094      ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:53442     192.168.2.156:9092      ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:48928     192.168.2.227:9092      ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:32856     120.79.186.232:9113     ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:59814     192.168.2.185:9092      ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:60048     192.168.2.168:9092      ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:49480     47.115.135.169:9092     ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:60134     120.79.15.181:14101     ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:34968     119.23.209.74:9092      ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:37062     119.23.209.74:14101     ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:44492     120.77.177.149:14101    ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:59580     120.79.186.232:9092     ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.2.168:33466     120.77.177.149:9092     ESTABLISHED</span><br></pre></td></tr></table></figure>
<h3 id="显示所有可用网卡">显示所有可用网卡</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -i</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Kernel Interface table</span><br><span class="line">Iface             MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg</span><br><span class="line">br-24ea9b4941ce  1500 12923986      0      0 0       8918266      0      0      0 BMU</span><br><span class="line">br-2b9072cf2223  1500        0      0      0 0             0      0      0      0 BMU</span><br><span class="line">br-4caf812bdaa6  1500        0      0      0 0             0      0      0      0 BMU</span><br><span class="line">br-52c539f436eb  1500  4420030      0      0 0       4572461      0      0      0 BMU</span><br><span class="line">br-6135592da74f  1500  7591698      0      0 0      11314882      0      0      0 BMRU</span><br><span class="line">br-bf1a2715a536  1500  7591698      0      0 0      11314882      0      0      0 BMU</span><br><span class="line">br-c3b89e07005b  1500        0      0      0 0             0      0      0      0 BMU</span><br><span class="line">br-dad742f48f75  1500     2091      0      0 0          6783      0      0      0 BMU</span><br><span class="line">br-e80111182b15  1500        0      0      0 0             0      0      0      0 BMU</span><br><span class="line">br-ff86e2f8db31  1500 12923986      0      0 0       8918266      0      0      0 BMU</span><br><span class="line">docker0          1500 42136153      0      0 0      68259406      0      0      0 BMRU</span><br><span class="line">enp4s0           1500 1904508155      0 2777565 0      2142106883      0      0      0 BMRU</span><br><span class="line">lo              65536 987259699      0      0 0      987259699      0      0      0 LRU</span><br></pre></td></tr></table></figure>
<h3 id="显示网络统计信息">显示网络统计信息</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -s</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">Ip:</span><br><span class="line">    2331469472 total packets received</span><br><span class="line">    100868012 forwarded</span><br><span class="line">    0 incoming packets discarded</span><br><span class="line">    2153729362 incoming packets delivered</span><br><span class="line">    2961922941 requests sent out</span><br><span class="line">    16 outgoing packets dropped</span><br><span class="line">    231 dropped because of missing route</span><br><span class="line">    285 reassemblies required</span><br><span class="line">    142 packets reassembled ok</span><br><span class="line">Icmp:</span><br><span class="line">    1683106 ICMP messages received</span><br><span class="line">    561981 input ICMP message failed.</span><br><span class="line">    InCsumErrors: 44</span><br><span class="line">    ICMP input histogram:</span><br><span class="line">        destination unreachable: 1678491</span><br><span class="line">        echo requests: 4424</span><br><span class="line">        echo replies: 147</span><br><span class="line">    1755127 ICMP messages sent</span><br><span class="line">    0 ICMP messages failed</span><br><span class="line">    ICMP output histogram:</span><br><span class="line">        destination unreachable: 1750607</span><br><span class="line">        echo request: 239</span><br><span class="line">        echo replies: 4281</span><br><span class="line">IcmpMsg:</span><br><span class="line">        InType0: 147</span><br><span class="line">        InType3: 1678491</span><br><span class="line">        InType8: 4424</span><br><span class="line">        OutType0: 4281</span><br><span class="line">        OutType3: 1750607</span><br><span class="line">        OutType8: 239</span><br><span class="line">Tcp:</span><br><span class="line">    75243858 active connections openings</span><br><span class="line">    52446738 passive connection openings</span><br><span class="line">    13907686 failed connection attempts</span><br><span class="line">    904581 connection resets received</span><br><span class="line">    55 connections established</span><br><span class="line">    2222345241 segments received</span><br><span class="line">    2883961201 segments send out</span><br><span class="line">    33088737 segments retransmited</span><br><span class="line">    335714 bad segments received.</span><br><span class="line">    11770965 resets sent</span><br><span class="line">Udp:</span><br><span class="line">    42916525 packets received</span><br><span class="line">    3132 packets to unknown port received.</span><br><span class="line">    0 packet receive errors</span><br><span class="line">    43474964 packets sent</span><br><span class="line">    0 receive buffer errors</span><br><span class="line">    0 send buffer errors</span><br><span class="line">UdpLite:</span><br><span class="line">TcpExt:</span><br><span class="line">    13429 invalid SYN cookies received</span><br><span class="line">    2868 resets received for embryonic SYN_RECV sockets</span><br><span class="line">    35 packets pruned from receive queue because of socket buffer overrun</span><br><span class="line">    329 ICMP packets dropped because they were out-of-window</span><br><span class="line">    59244840 TCP sockets finished time wait in fast timer</span><br><span class="line">    7185 packets rejects in established connections because of timestamp</span><br><span class="line">    23339679 delayed acks sent</span><br><span class="line">    .... // 省略一大堆输出</span><br><span class="line">IpExt:</span><br><span class="line">    InNoRoutes: 23</span><br><span class="line">    InMcastPkts: 11716265</span><br><span class="line">    OutMcastPkts: 78163</span><br><span class="line">    InBcastPkts: 52491220</span><br><span class="line">    InOctets: 1924057038252</span><br><span class="line">    OutOctets: 3172007243489</span><br><span class="line">    InMcastOctets: 1284732984</span><br><span class="line">    OutMcastOctets: 13779932</span><br><span class="line">    InBcastOctets: 10254385628</span><br><span class="line">    InNoECTPkts: 2384812576</span><br><span class="line">    InECT0Pkts: 614417</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://eleven26.github.io/2022/07/05/golang/goland%20%E6%97%A0%E6%B3%95%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96%E7%9A%84%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="eleven26">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eleven26">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | eleven26">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/05/golang/goland%20%E6%97%A0%E6%B3%95%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96%E7%9A%84%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">goland 无法下载依赖的问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-05 11:35:30" itemprop="dateCreated datePublished" datetime="2022-07-05T11:35:30+08:00">2022-07-05</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>问题：在本机运行的时候，执行了
<code>go get github.com/stretchr/testify</code>
之后，<code>go.mod</code> 里面的内容如下图，都飘红了。而且执行
<code>go mod tidy</code> 会直接移除这几个依赖，但是我的项目却是要依赖于
<code>github.com/stretchr/testify</code> 的。</p>
<p><img src="/images/go/mod/1.png" /></p>
<p>解决方法：goland 的配置中勾上
<code>Enable Go modules intergration</code></p>
<p><img src="/images/go/mod/2.png" /></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://eleven26.github.io/2022/07/02/linux/linux%20%E6%9F%A5%E7%9C%8B%E6%AD%A3%E5%9C%A8%E7%9B%91%E5%90%AC%E7%9A%84%E7%AB%AF%E5%8F%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="eleven26">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="eleven26">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | eleven26">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/02/linux/linux%20%E6%9F%A5%E7%9C%8B%E6%AD%A3%E5%9C%A8%E7%9B%91%E5%90%AC%E7%9A%84%E7%AB%AF%E5%8F%A3/" class="post-title-link" itemprop="url">linux/mac 查看正在监听的端口</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-02 09:45:00" itemprop="dateCreated datePublished" datetime="2022-07-02T09:45:00+08:00">2022-07-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="netstat">netstat</h2>
<p>要列出正在侦听的所有 TCP 或 UDP
端口，包括使用端口的服务和套接字状态，请使用以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -tunlp</span><br></pre></td></tr></table></figure>
<p>此命令中使用的选项具有以下含义：</p>
<ul>
<li><code>-t</code> - 显示 TCP 端口。</li>
<li><code>-u</code> - 显示 UDP 端口。</li>
<li><code>-n</code> - 显示数字地址而不是解析主机。</li>
<li><code>-l</code> - 只显示监听端口。</li>
<li><code>-p</code> - 显示监听进程的PID和名称。仅当您以 root 或sudo
用户身份运行命令时才会显示此信息。</li>
</ul>
<p>输出将如下所示：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      445/sshd            </span><br><span class="line">tcp        0      0 0.0.0.0:25              0.0.0.0:*               LISTEN      929/master          </span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      534/mysqld          </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      515/apache2         </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      445/sshd            </span><br><span class="line">tcp6       0      0 :::25                   :::*                    LISTEN      929/master          </span><br><span class="line">tcp6       0      0 :::33060                :::*                    LISTEN      534/mysqld          </span><br><span class="line">udp        0      0 0.0.0.0:68              0.0.0.0:*                           966/dhclient  </span><br></pre></td></tr></table></figure>
<p>列的含义：</p>
<ul>
<li><code>Proto</code> - 套接字使用的协议</li>
<li><code>Local Address</code> - 进程侦听的 IP 地址和端口号</li>
<li><code>PID/Program name</code> - PID 和进程的名称</li>
</ul>
<p>如果要过滤结果，请使用 grep 命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -tnlp | grep :22</span><br></pre></td></tr></table></figure>
<p>输出显示这台机器上的 22 端口被 SSH 服务器使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      445/sshd</span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      445/sshd</span><br></pre></td></tr></table></figure>
<p>如果输出为空，则表示端口上没有任何内容正在侦听。</p>
<p>您还可以根据条件过滤列表，例如 PID、协议、状态等。</p>
<h2 id="ss">ss</h2>
<p><code>ss</code> 是新的 <code>netstat</code>。它缺少一些
<code>netstat</code> 特性，但暴露了更多的 TCP
状态，而且速度稍快。命令选项基本相同，因此从 <code>netstat</code>
到的转换 <code>ss</code> 并不困难。</p>
<p>要通过 <code>ss</code> 获取所有侦听端口的列表：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ss -tunlp</span><br></pre></td></tr></table></figure>
<p>输出与 <code>netstat</code> 几乎相同：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">State    Recv-Q   Send-Q     Local Address:Port      Peer Address:Port                                                                                        </span><br><span class="line">LISTEN   0        128              0.0.0.0:22             0.0.0.0:*      users:((&quot;sshd&quot;,pid=445,fd=3))                                                        </span><br><span class="line">LISTEN   0        100              0.0.0.0:25             0.0.0.0:*      users:((&quot;master&quot;,pid=929,fd=13))                                                     </span><br><span class="line">LISTEN   0        128                    *:3306                 *:*      users:((&quot;mysqld&quot;,pid=534,fd=30))                                                     </span><br><span class="line">LISTEN   0        128                    *:80                   *:*      users:((&quot;apache2&quot;,pid=765,fd=4),(&quot;apache2&quot;,pid=764,fd=4),(&quot;apache2&quot;,pid=515,fd=4))   </span><br><span class="line">LISTEN   0        128                 [::]:22                [::]:*      users:((&quot;sshd&quot;,pid=445,fd=4))                                                        </span><br><span class="line">LISTEN   0        100                 [::]:25                [::]:*      users:((&quot;master&quot;,pid=929,fd=14))                                                     </span><br><span class="line">LISTEN   0        70                     *:33060                *:*      users:((&quot;mysqld&quot;,pid=534,fd=33))</span><br></pre></td></tr></table></figure>
<h2 id="lsof">lsof</h2>
<p><code>lsof</code>
是一个强大的命令行实用程序，可提供有关进程打开的文件的信息。</p>
<p>在 Linux 中，一切都是文件。您可以将套接字视为写入网络的文件。</p>
<p>要获取所有侦听 TCP 端口的列表，lsof 类型为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -nP -iTCP -sTCP:LISTEN</span><br></pre></td></tr></table></figure>
<p>使用的选项如下： * <code>-n</code> - 不要将端口号转换为端口名称。 *
<code>-p</code> - 不解析主机名，显示数字地址。 *
<code>-iTCP -sTCP:LISTEN</code> - 仅显示具有 TCP 状态 LISTEN
的网络文件。</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">COMMAND   PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">sshd      445     root    3u  IPv4  16434      0t0  TCP *:22 (LISTEN)</span><br><span class="line">sshd      445     root    4u  IPv6  16445      0t0  TCP *:22 (LISTEN)</span><br><span class="line">apache2   515     root    4u  IPv6  16590      0t0  TCP *:80 (LISTEN)</span><br><span class="line">mysqld    534    mysql   30u  IPv6  17636      0t0  TCP *:3306 (LISTEN)</span><br><span class="line">mysqld    534    mysql   33u  IPv6  19973      0t0  TCP *:33060 (LISTEN)</span><br><span class="line">apache2   764 www-data    4u  IPv6  16590      0t0  TCP *:80 (LISTEN)</span><br><span class="line">apache2   765 www-data    4u  IPv6  16590      0t0  TCP *:80 (LISTEN)</span><br><span class="line">master    929     root   13u  IPv4  19637      0t0  TCP *:25 (LISTEN)</span><br><span class="line">master    929     root   14u  IPv6  19638      0t0  TCP *:25 (LISTEN)</span><br></pre></td></tr></table></figure>
<p>要查找正在侦听特定端口的进程，例如，3306您将使用的端口：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -nP -iTCP:3306 -sTCP:LISTEN</span><br></pre></td></tr></table></figure>
<p>输出显示 MySQL 服务器使用端口3306：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COMMAND PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">mysqld  534 mysql   30u  IPv6  17636      0t0  TCP *:3306 (LISTEN)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/24/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span><a class="page-number" href="/page/26/">26</a><span class="space">&hellip;</span><a class="page-number" href="/page/70/">70</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/26/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">eleven26</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/eleven26" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
